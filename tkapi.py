import scrapy
import json
from scrapy import cmdline
from json import JSONDecodeError
import logging


class TkapiSpider(scrapy.Spider):
    name = 'tkapi'
    #start_urls = ["https://tiki.vn/api/v2/products/53434797"]
    # allowed_domains = ['s']
    # start_urls = ['http://s/']

    custom_settings = {
        'FEED_EXPORT_ENCODING' : 'utf-8',
        'DOWNLOAD_DELAY': 0.5
    }

    headers = {
    'accept': 'application/json, text/plain, */*',
    'accept-encoding': 'gzip, deflate, br',
    'accept-language': 'en-US,en;q=0.9',
    'referer': 'https://tiki.vn/he-mien-dich-kiet-tac-cua-su-song-p48895045.html?spid=48895046',
    'sec-ch-ua': '"Opera";v="95", "Chromium";v="109", "Not;A=Brand";v="24"',
    'sec-ch-ua-mobile': '?0',
    'sec-ch-ua-platform': '"Windows"',
    'sec-fetch-dest': 'empty',
    'sec-fetch-mode': 'cors',
    'sec-fetch-site': 'same-origin',
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36 OPR/95.0.0.0',
    'x-guest-token': 'tYnAkieDWjgsyPu8om1Fr9fI2RzJSlZB'
    }

    def start_requests(self):
        # p_ids cào trước đấy r nên cop vào luôn
        p_ids = [53434797, 10005245, 2380007, 550167, 196201375, 74021317, 184466860, 189643105, 207841114, 3304875, 167940010, 109017985, 106863963, 52789367, 73787185, 8848897, 93249305, 213736028, 130327841, 106863963, 75953557, 198414891, 199216988, 117238177, 209891492, 15267827, 46240929, 147920903, 3954355, 188940817, 69764541, 26114399, 1476937, 121635152, 117254517, 206840682, 71345381, 4780917, 204078065, 207841170, 2380007, 8848897, 197337637, 91998790, 199684637, 72459686, 72882553, 3639597, 111285062, 17336364, 207256575, 57325187, 205942269, 106318762, 124767703, 174377494, 151591896, 50359874, 135552451, 45211100, 127844385, 157240665, 85763211, 194959173, 8885999, 197629362, 87226756, 168283405, 70016692, 
            207301603, 145288029, 4940239, 54422942, 109793160, 208289692, 3014291, 193206168, 161008715, 19792256, 174444163, 132206365, 91998790, 214762192, 190843369, 66619715, 109505434, 49459956, 203865315, 10005245, 13419678, 10095276, 195801692, 90622579, 92859698, 185067342, 982037, 11368965, 147999778, 199692508, 203701749, 190861557, 212580837, 12377498, 200780130, 107802183, 4313653, 147988216, 74362508, 204806201, 435979, 173865570, 179546070, 208128941, 185071145, 94173458, 208124532, 196932307, 57762732, 202450677, 184419723, 381234, 27582931, 163703151, 52329763, 202851053, 162844699, 195649312, 151994935, 205563269, 56454897, 76013378, 75307228, 10140336, 74341297, 78598381, 203954152, 614854, 72308265, 8886007, 52805060, 97594364, 202895291, 17336360, 8886001, 155880591, 126743459, 50414368, 214598378, 2245453, 121635154, 207841141, 17879295, 198419657, 21367457, 45902241, 85396163, 210137543, 195187480, 192124399, 76388962, 7718737, 202853032, 195801653, 197634260, 187338036, 50072452, 207852953, 168293266, 201877500, 179063564, 177746995, 120219394, 205349079, 105663942, 111290696, 205033951, 203231465, 200694866, 49747007, 214497208, 641906, 196851822, 76776245, 195801690, 106185389, 140416373, 194960721, 197781972, 208289515, 108715084, 179546078, 54614797, 
            109018530, 92096344, 145288026, 196001691, 196515658, 181974015, 166033489, 203957925, 545278, 206847854, 76541999, 203231264, 214757473, 182972780, 201679848, 5067169, 212992673, 195357772, 3071853, 194960730, 79672197, 154245455, 104769768, 3608625, 142002263, 11122712, 195801686, 2496281, 211936525, 167972598, 210277880, 160997378, 3608623, 202153817, 11371249, 202879294, 213704979, 3737963, 139303869, 91947689, 35283863, 
            87226754, 82912488, 80960198, 161310103, 205299640, 138107485, 193979870, 173748415, 105483727, 80628929, 195190105, 73125816, 86517373, 23416722, 112110014, 57587819, 184801142, 201892204, 197781967, 184070223, 153045603, 69644748, 160548374, 139567621, 113540576, 81323246, 192115858, 59511811, 212567558, 200779133, 191045569, 205299815, 168559521, 161256053, 378448, 35191892, 120509490, 78015044, 198644080, 205757105, 173882436, 207841129, 205299813, 158019962, 174038838, 136143567, 208289682, 197634252, 197344455, 54053521, 208789857, 55319105, 196851826, 205574133, 176550321, 212465495, 209398575, 155550591, 73878873, 69978860, 205942260, 110448022, 71907876, 205819593, 87959748, 52785564, 173763072, 26168610, 186434700, 204078070, 73207240, 158019964, 203701754, 207217783, 201048325, 197719874, 90887853, 106997685, 7982628, 540039, 177637709, 8835159, 200934947, 2393619, 625841, 394013, 198415075, 214757466, 196016785, 204051994, 72001057, 186237324, 202466690, 14053724, 5154511, 93327797, 201580271, 198127380, 184774173, 159004131, 143186001, 171825201, 102629318, 193450577, 209349142, 179952621, 207398354, 425716, 204539920, 205148096, 194114725, 162205263, 148760924, 197119849, 201226690, 56226544, 69764534, 207841177, 186290796, 100931418, 100931416, 100376369, 1007137, 212465503, 211924955, 193211309, 9948025, 187190676, 124767704, 31509726, 101787132, 212582470, 14684952, 204363209, 200780132, 15397971, 115266692, 217184807, 73434639, 36363381, 58695343, 72202103, 205941719, 179735872, 195885678, 198419652, 194199544, 130233544, 202878483, 105614684, 186271356, 152875147, 96616370, 162100202, 129937246, 144779882, 210277362, 13333355, 197708849, 205756958, 200619497, 200619298, 202153825, 162181800, 200619300, 190592910, 100947274, 152740748, 197674390, 210147382, 202851059, 197588247, 52329861, 67040913, 190242074, 
            57211757, 109310241, 50751279, 100958457, 113656455, 196923457, 196948209, 193177952, 144079756, 55506686, 149180057, 168662171, 196001721, 207937181, 76181976, 193434490, 179546672, 750578, 116397449, 201431422, 199739994, 208560319, 197353397, 214075599, 96357336, 112106439, 191571494, 198571360, 194104216, 104273017, 205148084, 20917699, 208603679, 52329765, 198016656, 73316977, 192124393, 53532186, 41299108, 106863962, 208560332, 189940724, 197587865, 19662184, 171549981, 182736912, 95218451, 196851314, 74460137, 209176879, 190464440, 14136016, 108684605, 203957932, 53434797, 70016690, 117595535, 205986080, 198434875, 213680830, 199177647, 198198483, 106365090, 185435307, 145288031, 90056907, 153518828, 114765005, 125930806, 196394972, 186880504, 166327477, 214076459, 208603680, 71090268, 10920495, 141531685, 163553056, 205148090, 203757840, 
            197558905, 197353393, 197629358, 206619326, 207831764, 188960734, 72680632, 196515661, 167146640, 1445365, 198414404, 108501279, 22881852, 185435285, 56692532, 184070221, 94173462, 70224520, 202491433, 207007287, 204078067, 213619207, 50475521, 198644535, 149573910, 57870426, 145289356, 208124554, 203959383, 186578989, 206676975, 181379116, 186286187, 210277490, 149089470, 186237333, 80141519, 191148794, 70743650, 195980676, 
            93249305, 63587072, 117681065, 11189120, 196932335, 49249526, 192909291, 197587856, 195801673, 176824204, 205749384, 69764547, 121185868, 150997930, 113070836, 157255752, 171821043, 188128048, 148008757, 204363212, 100931414, 509829, 202891560, 195545304, 95218447, 95090643, 213701589, 204635043, 104314401, 170298038, 13624088, 105634696, 185409456, 480687, 139979524, 90985722, 184475053, 217419212, 207426745, 77230663, 5154645, 58390336, 190592917, 199241859, 188940825, 214757467, 207439063, 196849396, 205000920, 202015697, 185445037, 67271338, 179546074, 73165394, 66698344, 206607139, 148750882, 22878271, 202153823, 202710687, 201004695, 13828946, 168373800, 111981249, 212468530, 207475552, 126742911, 50685547, 174215347, 206576737, 168234714, 207255710, 200928947, 14645351, 95997783, 193433863, 185055209, 207968701, 147988185, 182551492, 59618902, 196944533, 200780124, 165150439, 192475873, 130996082, 181699688, 56218385, 77109209, 66398387, 88592202, 176933390, 93734071, 167210779, 
            157412117, 189326211, 13446508, 201580265, 4255933, 17960478, 162837790, 193896563, 27611077, 195885684, 116406678, 124639646, 106149739, 205745317, 126474205, 76012203, 129381098, 171556602, 186290790, 997535, 1471887, 88791130, 207256599, 203757836, 27594632, 146223395, 189326210, 206308040, 201437947, 160759005, 157195847, 191571530, 181699664, 3082815, 178483666, 198342225, 20444622, 11368983, 14436301, 161245852, 126743464, 145977548, 74684480, 213701594, 103550551, 205694539, 21031780, 2429811, 480226, 74981856, 207217788, 8011021, 149257065, 102629342, 73207098, 192048665, 195545322, 190238356, 104651900, 178294073, 201580268, 201933789, 203225618, 73515859, 51474583, 78632968, 138226289, 53789573, 
            58627102, 185024355, 177569697, 766386, 201693190, 208603684, 174215331, 92732216, 156824943, 173364636, 212356652, 72744612, 184466862, 125528587, 170463582, 179722513, 141333746, 47342678, 180851000, 1926761, 148600242, 168662558, 43859629, 193895769, 32056951, 150838230, 193895767, 
            71990280, 198728079, 193226972, 169621659, 185242031, 832239, 130996088, 196409859, 142791749, 187009994, 212213016, 207780301, 147058065, 198415068, 198644083, 2126103, 39228816, 208124546, 72542509, 203231461, 51244265, 196849405, 75338644, 195801680, 189676642, 129765498, 185340443, 32192510, 195306005, 196849394, 73553829, 46789754, 137741275, 111285054, 100947276, 194960245, 187619074, 119226083, 169621664, 77900446, 148802202, 113655001, 200694869, 194471830, 213728190, 206308045, 170706973, 196001724, 155350472, 84970841, 130997085, 206308050, 205802190, 192908778, 198415080, 3698473, 193151000, 79937406, 197634254, 3876677, 10325548, 157432540, 21129054, 178483637, 3723281, 136980493, 201850382, 201017146, 184036405, 196849395, 179175746, 197337637, 4466841, 77900454, 188930494, 195826888, 196849406, 210137547, 171057415, 176550203, 142675354, 167686691, 95218547, 80142833, 2903309, 189573198, 194959694, 984938, 117035933, 205576473, 54624820, 204661038, 173156781, 169914763, 97507712, 144203242, 44433397, 187843292, 57110087, 201693198, 656342, 194960252, 209176883, 4184211, 85029033, 202878485, 1934493, 168114449, 48481763, 214922280, 217419218, 200780111, 11357193, 201687274, 193605362, 205336477, 190605360, 113540577, 59395854, 84595858, 197657917, 143226165, 167301575, 194104633, 115478654, 169621652, 215981940, 203757843, 5112975, 174377494, 160585764, 189350061, 203865322, 90469338, 50668886, 74269729, 169621666, 207217770, 214922281, 77122341, 193446630, 158641027, 213911368, 113655533, 96327064, 199045170, 111849841, 49365848, 200877611, 201592094, 160585834, 207032950, 170345816, 176752838, 148008778, 180851254, 531103, 200619302, 190701644, 95090744, 196517619, 216409030, 196515668, 143172597, 207005202, 174605338, 199037286, 101870295, 73222800, 56750844, 215984899, 214077231, 185027514, 197634255, 190242072, 56445333, 154160965, 191782162, 90985718, 183551389, 38436486, 45438055, 191636272, 192833921, 194104223, 196849403, 106864418, 202450684, 49181801, 199520413, 196849393, 205423656, 138396005, 12107394, 110965784, 21316805, 186267244, 201037627, 197344439, 69644752, 202650475, 48323805, 201437949, 160585830, 614878, 203211985, 205942280, 155463025, 2380007, 34267257, 198728075, 9490657, 73102465, 191655862, 203842330, 186290792, 198198501, 198198479, 75615273, 196201375, 111153025, 66090079, 198414191, 199177643, 171549946, 201592092, 200694865, 134846265, 200630838, 187859732, 124767712, 153521878, 1021663, 49910019, 128649312, 12533371, 9948009, 94803796, 143185998, 25557704, 203757842, 168924459, 174626700, 81437585, 186495458, 126853168, 131139976, 73105037, 193896567, 38265901, 10678954, 22472008, 1670619, 54003813, 148937391, 166033459, 176550199, 626886, 56801009, 194960236, 10392851, 169621653, 192950378, 148761077, 212992372, 193567343, 198644085, 208289511, 202450671, 49722650, 207256595, 177117486, 8965213, 194104232, 193917209, 196290947, 214613060, 44183113, 204805806, 183551390, 111537683, 71898415, 185435294, 
            71094783, 115873770, 170098856, 196932349, 196394987, 45321626, 203763651, 87569364, 164336673, 540040, 68350215, 197657918, 9695881, 76443018, 52597663, 212465498, 72000017, 203231463, 171212880, 148760915, 196019293, 77982982, 107342987, 125939195, 196422809, 206576745, 59043891, 208608158, 210278154, 23943911, 49506137, 148802194, 109018532, 99513994, 175724125, 207830866, 633125, 185909477, 196515664, 207439072, 196150464, 189641377, 199240640, 13443886, 177736586, 198414410, 46332534, 57761618, 50269973, 50322156, 77225336, 58493549, 217419210, 58342212, 173650547, 198214257, 196849400, 205181876, 45321594, 95090673, 196856119, 100347903, 163165281, 143513113, 129381090, 192909304, 113656189, 140120577, 192909289, 8021467, 212212326, 117002702, 176473191, 10397241, 139296704, 177747013, 182972777, 66712456, 192333855, 8835165, 55119955, 191320058, 187827445, 188548615, 29591064, 193434494, 193434488, 19370504, 176824199, 111285050, 204806061, 169825414, 196409700, 199142722, 210147383, 3644267, 163165068, 15256884, 196422807, 200619495, 196851310, 205540677, 109998520, 60910620, 76175424, 110448020, 40774181, 5914507, 207400594, 189558189, 75823566, 190859600, 199901869, 185067350, 160931492, 193450572, 80896006, 57905707, 10767515, 210273627, 186290800, 160585762, 34612056, 188536931, 1664525, 175845415, 179546674, 73139676, 206308054, 151994933, 140416366, 186094200, 205757077, 186290802, 55605172, 67491398, 160488843, 145092110, 188548575, 83680364, 184782104, 80657321, 172206434, 10227722, 194205620, 195969669, 194033594, 198414407, 201048330, 1667291, 145499994, 3048355, 198414405, 12107379, 35785372, 187805737, 145287904, 196849389, 52332414, 193988323, 54433518, 137561095, 145300494, 203511764, 213678473, 193099631, 176909246, 2716247, 37667006, 46259908, 195291930, 137161811, 188960732, 10405966, 211936511, 71149569, 195969664, 212287888, 145977554, 83757977, 202450668, 197558907, 187889757, 58441509, 205815553, 121185870, 208289505, 121372698, 83664156, 
            37411897, 115093388, 192125806, 46626771, 112825941, 21130350, 200619499, 199045171, 195792120, 199544136, 109322300, 203865320, 3955683, 205745286, 205696535, 88231463, 1471885, 208406304, 194205626, 197781968, 195357774, 211936520, 201892202, 90480255, 7369223, 137241901, 147920905, 
            1204909, 147220978, 4080373, 192124401, 193896561, 189765038, 194110075, 147802908, 160081250, 49317816, 89591450, 160585832, 157054867, 136340700, 55119185, 8886005, 195291853, 527316, 170706990, 145634338, 11470936, 184466858, 188381614, 213701591, 169621657, 23437828, 177312713, 213701365, 204874996, 207831762, 568762, 200779122, 9948021, 113655308, 126022117, 123236564, 1667307, 185909442, 47242742, 183058543, 186290824, 
            4319337, 200853725, 1686729, 41131985, 58165559, 40750124, 48629556, 197587870, 84565498, 196411152, 209398582, 205010302, 193446626, 109633951, 22610399, 205336473, 196150482, 72667834, 208450453, 107802188, 206576725, 207217794, 58213080, 208505786, 198573178, 447164, 174605333, 205942263, 207959037, 50356123, 207475556, 187827433, 101801426, 187933654, 148802204, 168576295, 142833449, 125009501, 843279, 213863183, 208406296, 201431426, 23433003, 73682817, 175955626, 206308055, 197352631, 192909292, 77105810, 176550307, 150711999, 54422996, 168900733, 58864689, 205000918, 213863186, 201390508, 157255019, 201048329, 520330, 109135940, 215141304, 119694726, 195801321, 113540588, 175176401, 213492171, 194960246, 202851051, 208121657, 208193242, 205033919, 213863189, 200628215, 56757447, 544731, 138269668, 95289208, 92492870, 186088881, 190602382, 
            205745313, 197601746, 174215334, 193446629, 193897108, 84950232, 16082945, 196849409, 197781975, 184766289, 68570324, 1938895, 57911668, 95089958, 158868255, 196932362, 101782486, 159259017, 179063566, 194104629, 197353391, 72540051, 980770, 75813201, 174037877, 208406298, 190589680, 1325399, 55462653, 113583126, 173745189, 174444202, 82041440, 76012201, 199040148, 45663008, 480040, 27611050, 19274771, 192909296, 107492789, 186265453, 11472231, 114046590, 205942265, 54682252, 168231621, 3283535, 77105703, 160081252, 8121633, 188930498, 111582631, 139979522, 56697257, 191636255, 212427422, 190238358, 204649516, 128635778, 206844673, 204473050, 187843291, 80417220, 91277007, 202851049, 55078233, 174444190, 138504802, 194568580, 55605170, 95311763, 1362559, 191571444, 184781427, 145093003, 208406299, 149974908, 203763655, 14983742, 206308042, 198858933, 35193352, 186880675, 4085859, 95220861, 19588948, 195801664, 16284262, 116835635, 87149160, 49904794, 164336678, 209876058, 191045565, 102159092, 192333857, 201892200, 143858325, 91985053, 212427430, 160488838, 91343712, 177477619, 173135243, 189557421, 104324820, 198302147, 94878710, 175833959, 201562338, 59478514, 51845986, 69624539, 207754094, 193896500, 203757834, 210147371, 209176875, 198214253, 196422805, 214076434, 205033830, 104315085, 52218420, 194104631, 191636265, 520358, 196016781, 206607118, 201431424, 195801646, 152522279, 143362752, 197745233, 158235745, 189598539, 73238663, 36332673, 52696535, 113060806, 187622420, 205039768, 152517438, 217148632, 70016676, 107058289, 155350479, 200619493, 196831943, 137241842, 207398360, 193684715, 74277389, 48895045, 206678865, 100958464, 91471511, 139202747, 105910471, 32219488, 44976191, 
            5067167, 72615305, 114578907, 71947999, 13312178, 95141872, 206675362, 179952409, 197781971, 74689091, 104074997, 214598372, 181928999, 167019723, 10366395, 394434, 109765020, 58543601, 203910491, 161408750, 200672813, 50247004, 90866359, 5743603, 83432000, 185909452, 136540009, 173515982, 49998524, 110448030, 105664072, 84950236, 37866684, 188535080, 67991600, 185889844, 145288035, 207825239, 884432, 207968695, 14655498, 13290131, 157540009, 106375683, 193411736, 195885685, 12489237, 202895294, 44627532, 213492162, 173135247, 207427379, 197558906, 2812299, 55071991, 184226856, 213863185, 57905703, 178031172, 111536248, 93249197, 48362492, 208285393, 214076457, 198770633, 21130354, 571210, 58629614, 184415422, 200997680, 43986365, 189641379, 201048333, 53452969, 74983590, 142833447, 109982956, 193981038, 182149648, 207494286, 14655136, 8128223, 23827298, 71880692, 207475544, 181699610, 77982978, 111285052, 193895773, 114572110, 51702499, 13362558, 196517620, 212992705, 155115301, 74983567, 52329758, 205927383, 46332538, 207825075, 157468180, 58932964, 202796286, 82072617, 76776251, 109982846, 54120846, 48329789, 109862191, 192788797, 101325467, 189326227, 187827390, 7544175, 60808682, 80970604, 203937562, 45321628, 197587848, 5458537, 175146839, 204805810, 7982626, 202851047, 204805812, 194199558, 152464642, 193981042, 81499980, 190214568, 179547036, 98648742, 4978895, 197657913, 184101370, 186080463, 110181955, 214075601, 208124522, 205059388, 201003188, 193099628, 186211127, 199728871, 197745260, 520343, 57518431, 3152291, 170297937, 198415069, 
            165956567, 199547421, 88826423, 191353862, 69219921, 73316970, 195980779, 219140654, 199177641, 3640421, 135350713, 76012191, 11452589, 121949300, 4790473, 164336681, 111155169, 190707619, 195190275, 172175794, 153521874, 187509010, 52691750, 178240547, 125932213, 20750197, 115972858, 
            149974918, 73222804, 71553549, 109488215, 187843301, 199030585, 146936894, 181131167, 130997089, 49002497, 194960238, 205617693, 23437685, 214080797, 197636446, 204806203, 206576729, 131843989, 214160510, 193478723, 847470, 180225973, 175956866, 76278485, 158307843, 191148787, 204771676, 210143419, 217184804, 51215567, 91861712, 13901884, 35170705, 201244352, 198296811, 167149888, 7440075, 187827438, 53095591, 186286180, 187933551, 193450565, 198016658, 195885688, 110448037, 57300933, 179063535, 149534865, 112332742, 209176887, 192949866, 38223395, 182467966, 187190670, 165030720, 1823525, 205625925, 190630610, 190707002, 72818335, 52785566, 139296424, 85549938, 58566219, 191506179, 58547337, 109982968, 42459021, 19948893, 377644, 71957923, 207256577, 113540589, 394421, 184419744, 111537689, 201355034, 187279375, 198204746, 76014598, 9687403, 138934620, 195801674, 71553537, 75639706, 101897983, 212264261, 214199407, 197990867, 130083857, 77988131, 193917208, 107464900, 51566162, 201307595, 186202652, 102832722, 144451595, 83162438, 137751490, 190701636, 58067806, 2782635, 205540599, 195801647, 75697497, 185435312, 177746994, 48362502, 54616131, 188535523, 595476, 193434499, 215983663, 23609962, 110583137, 47323853, 165659884, 201003776, 198016673, 197990865, 197230166, 147920907, 207841138, 108239940, 198198489, 46849710, 40933973, 42230604, 213936844, 174449880, 38436464, 201698690, 212426874, 196831956, 107363748, 192339427, 186290795, 183488713, 45663835, 192161603, 53301432, 58462050, 44351649, 23413038, 7804743, 14616755, 40052042, 206837303, 80141527, 115078652, 127077157, 95311757, 510195, 192448028, 195190110, 2848355, 179994349, 35305803, 177736600, 171095911, 53974339, 197352628, 186202768, 157955619, 101807254, 14643411, 170708219, 99681450, 191571462, 106788395, 183539215, 174038857, 129911446, 168559524, 176824194, 870619, 96867790, 186286177, 1534613, 91120169, 75630595, 48592472, 176906726, 101296988, 202029425, 56256828, 48629535, 202038340, 45663006, 
            155463021, 207968899, 23410476, 215984699, 67060014, 138138635, 205986062, 204363203, 3210775, 1822907, 77665388, 129766803, 181915295, 195288805, 59362973, 127844380, 162832796, 48329799, 198215147, 73854882, 195306000, 51251660, 110944248, 82072620, 34340291, 195801696, 171170802, 186290810, 204766262, 143676192, 208286135, 169062014, 192692368, 180396223, 85560172, 13816239, 146846340, 198208145, 84808699, 195801644, 196284164, 196851308, 188767663, 172800656, 13673970, 177321527, 189557807, 1475793, 2027349, 104465376, 23956857, 115483166, 16284286, 170490710, 101646537, 110170275, 22881827, 76588970, 95090377, 137825297, 69162891, 95220863, 200616826, 147568390, 213571970, 1674007, 56226546, 201012080, 149677745, 188930496, 200852592, 196290945, 205336475, 193100617, 200634061, 209176765, 192474352, 36854641, 199176577, 71957695, 54208917, 181699672, 132366463, 657307, 202028583, 196831939, 1747347, 33543715, 110944231, 11119019, 196424300, 55589742, 191529453, 87391039, 156821160, 50723822, 206308058, 155416328, 51711216, 6926849, 68350213, 1750249, 46107066, 57905699, 109298270, 2848361, 7710132, 174626750, 119898121, 72917578, 182463032, 3283713, 76282196, 67060012, 188551115, 175956865, 1660829, 48362500, 33543717, 139207275, 206266518, 196831950, 97589652, 
            191571328, 73125818, 87108686, 178032061, 334838, 188687021, 40933977, 170094970, 24951095, 111582638]
        
        #yield scrapy.Request(url=url, callback=self.parser_product, headers=self.headers, dont_filter=False)
        for i in p_ids:
            url=f"https://tiki.vn/api/v2/products/{i}?platform=web&spid={i}"
            yield  scrapy.Request(url=url, callback=self.parser_product, headers=self.headers, dont_filter=False)
    
    def parser_product(self, response):
        if response.body == None or response.body == '':
            print('I got a null or empty string value for data in a file')
        else:
            try:
                resp = json.loads(response.body)
                if 'all_time_quantity_sold'  in resp:
                    sold = resp['all_time_quantity_sold']
                else:
                    sold = "No info"
            except ValueError:
                self.log("Error catch ValueError!!!")
               
        #resp = json.loads(response.body) 
        yield{
            'name' : resp['name'],
            'original_price' : resp['original_price'],
            'discount' :resp['discount'],
            'price' : resp['price'],
            'rating_average' : resp['rating_average'],
            'review_count' : resp['review_count'],
            'productset_group_name': resp['productset_group_name'],
            'sold' : sold
        }
        


cmdline.execute("scrapy runspider tkapi.py -O file.json".split())




   
